---
import Layout from '../layouts/Layout.astro';
---

<Layout title="P&P Electricidad - Iniciar Sesión">
	<div class="login-container">
		<div class="login-card">
			<div class="login-form-side">
				<div class="logo-container">
					<img src="/logo.png?v=2" alt="P&P Electricidad" class="logo" />
				</div>
				<div id="loginSection">
					<h1>Iniciar Sesión</h1>
					<form id="loginForm">
						<div class="form-group">
							<label for="username">Usuario</label>
							<input type="text" id="username" name="username" required />
						</div>
						<div class="form-group">
							<label for="password">Contraseña</label>
							<input type="password" id="password" name="password" required />
						</div>
						<button type="submit" class="btn btn-primary" style="width: 100%;">Ingresar</button>
						<div id="loginError" class="error-message"></div>
						<p class="auth-switch">
							¿No tienes cuenta? <a href="/register" id="showRegister">Regístrate aquí</a>
						</p>
					</form>
				</div>
			</div>
			</div>
			<!-- Image removed as requested -->
		</div>
	</div>
</Layout>

<style>
	.login-container {
		min-height: 100vh;
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 1rem;
		/* background-color removed to show global background */
	}

	.login-card {
		background: white;
		border-radius: 1rem;
		box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
		width: 100%;
		max-width: 450px; /* Reduced max-width since it's single column now */
		overflow: hidden;
	}

	.login-form-side {
		padding: 2.5rem;
	}

	.logo-container {
		text-align: center;
		margin-bottom: 2rem;
	}

	.logo {
		height: 150px;
		width: auto;
		mix-blend-mode: multiply;
	}

	h1 {
		font-size: 1.5rem;
		font-weight: 700;
		color: var(--gray-900);
		margin-bottom: 1.5rem;
		text-align: center;
	}

	.auth-switch {
		margin-top: 1.5rem;
		text-align: center;
		font-size: 0.9rem;
		color: var(--gray-600);
	}

	.auth-switch a {
		color: var(--primary-color);
		text-decoration: none;
		font-weight: 600;
	}

	.auth-switch a:hover {
		text-decoration: underline;
	}
</style>

<script>
	import { login } from '../stores/appStore';

	const loginForm = document.getElementById('loginForm') as HTMLFormElement;
	const loginError = document.getElementById('loginError') as HTMLDivElement;

	// Login logic
	loginForm.addEventListener('submit', (e) => {
		e.preventDefault();

		const formData = new FormData(loginForm);
		const username = formData.get('username') as string;
		const password = formData.get('password') as string;

		const user = login(username, password);

		if (user) {
			if (user.role === 'admin') {
				window.location.href = '/admin';
			} else {
				window.location.href = '/client';
			}
		} else {
			loginError.textContent = 'Usuario o contraseña incorrectos';
			loginError.classList.add('show');
			setTimeout(() => {
				loginError.classList.remove('show');
			}, 3000);
		}
	});
</script>
