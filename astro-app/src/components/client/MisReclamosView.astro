<div id="misReclamosView" class="view">
	<h2>Mis Reclamos</h2>
	<div id="misReclamosList"></div>
</div>

<style>
	.admin-response {
		margin-top: 1.5rem;
		padding: 1rem;
		border-radius: 0.5rem;
		border-left: 4px solid #ccc;
		background-color: #f9fafb;
	}

	.admin-response.accepted {
		border-left-color: var(--success-color);
		background-color: #ecfdf5;
	}

	.admin-response.rejected {
		border-left-color: var(--danger-color);
		background-color: #fef2f2;
	}

	.admin-response h4 {
		margin-top: 0;
		margin-bottom: 0.5rem;
		color: var(--gray-700);
		font-size: 1rem;
	}

	.resolution-badge {
		margin-top: 1rem;
		font-weight: bold;
		font-size: 0.9rem;
	}
</style>

<script>
	import { $currentUser, $reclamos, getReclamosByUser } from '../../stores/appStore';

	function renderMisReclamos() {
		const currentUser = $currentUser.get();
		if (!currentUser) {
			window.location.href = '/';
			return;
		}

		const reclamos = getReclamosByUser(currentUser.username);
		const container = document.getElementById('misReclamosList');
		
		if (!container) return;

		if (reclamos.length === 0) {
			container.innerHTML = `
				<div class="empty-state">
					<h3>No tiene reclamos registrados</h3>
					<p>Sus reclamos aparecerán aquí</p>
				</div>
			`;
			return;
		}

		container.innerHTML = reclamos.map(reclamo => `
			<div class="card">
				<div class="solicitud-header">
					<h3>Reclamo #${reclamo.id}</h3>
					<span class="badge ${reclamo.status === 'open' ? 'badge-pending' : 'badge-approved'}">
						${reclamo.status === 'open' ? 'Abierto' : 'Cerrado'}
					</span>
				</div>
				<div class="solicitud-info">
					<p><strong>Número de Pedido:</strong> ${reclamo.numPedido}</p>
					<p><strong>Fecha:</strong> ${reclamo.fecha}</p>
					<p><strong>Descripción:</strong></p>
					<p>${reclamo.descripcion}</p>
					${reclamo.response ? `
						<div class="admin-response ${reclamo.resolution === 'accepted' ? 'accepted' : 'rejected'}">
							<h4>Respuesta del Administrador:</h4>
							<p>${reclamo.response}</p>
							<div class="resolution-badge">
								${reclamo.resolution === 'accepted' ? '✅ Reclamo Aceptado' : '❌ Reclamo Rechazado'}
							</div>
						</div>
					` : ''}
				</div>
			</div>
		`).join('');
	}

	// Initial render
	renderMisReclamos();

	// Subscribe to changes
	$reclamos.subscribe(renderMisReclamos);

	// Re-render when view becomes active
	window.addEventListener('viewChange', (e: Event) => {
		const customEvent = e as CustomEvent;
		if (customEvent.detail.viewId === 'misReclamos') {
			renderMisReclamos();
		}
	});
</script>
